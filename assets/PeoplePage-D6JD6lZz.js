import{j as t,L as P,c as x,u as v,a as N,r as h,b as A}from"./index-BYikBKk6.js";import{T as B}from"./Title-EgAigLYR.js";const D=({errorMessage:e,dataCy:s})=>t.jsx("p",{"data-cy":s,className:"has-text-danger",children:e}),f=({person:e})=>t.jsx(P,{to:`../${e.slug}`,className:x("",{"has-text-danger":e.sex==="f"}),children:e.name}),F=()=>{const{personId:e}=v();return{personId:e}},k=({person:e})=>{const{slug:s,sex:r,born:n,died:a,motherName:l,fatherName:c,mother:o,father:d}=e,{personId:m}=F();return t.jsxs("tr",{"data-cy":"person",className:x({"has-background-warning":m===s}),children:[t.jsx("td",{children:t.jsx(f,{person:e})}),t.jsx("td",{children:r}),t.jsx("td",{children:n}),t.jsx("td",{children:a}),t.jsx("td",{children:o?t.jsx(f,{person:o}):l}),t.jsx("td",{children:d?t.jsx(f,{person:d}):c})]})};function g(e,s){const r=new URLSearchParams(e.toString());return Object.entries(s).forEach(([n,a])=>{a===null?r.delete(n):Array.isArray(a)?(r.delete(n),a.forEach(l=>{r.append(n,l)})):r.set(n,a)}),r.toString()}const j=({children:e,params:s,...r})=>{const[n]=N();return t.jsx(P,{to:{search:g(n,s)},...r,children:e})};var i=(e=>(e.SEX="sex",e.NAME="name",e.BORN="born",e.DIED="died",e))(i||{}),u=(e=>(e.DESC="desc",e.ASC="asc",e))(u||{});const M=[{title:"All",params:{sex:null}},{title:"Male",params:{sex:"m"}},{title:"Female",params:{sex:"f"}}],I=[{title:"16",century:"16"},{title:"17",century:"17"},{title:"18",century:"18"},{title:"19",century:"19"},{title:"20",century:"20"}],R=[{title:"Name",sortType:i.NAME},{title:"Sex",sortType:i.SEX},{title:"Born",sortType:i.BORN},{title:"Died",sortType:i.DIED}],y=()=>{const[e]=N(),s=e.get("sort")||null,r=e.get("order")||null;return{sort:s,order:r,getSortParams:a=>!s||s&&s!==a?{sort:a,order:null}:s===a&&r!==u.DESC?{sort:a,order:u.DESC}:{sort:null,order:null}}},O=({sortType:e})=>{const{sort:s,order:r}=y(),n=()=>s===e&&r?t.jsx("i",{className:"fas fa-sort-down"}):s===e?t.jsx("i",{className:"fas fa-sort-up"}):t.jsx("i",{className:"fas fa-sort"});return t.jsx("span",{className:"icon",children:n()})},T=({people:e})=>{const{getSortParams:s}=y();return t.jsxs("table",{"data-cy":"peopleTable",className:"table is-striped is-hoverable is-narrow is-fullwidth",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[R.map(({sortType:r,title:n})=>t.jsx("th",{children:t.jsxs("span",{className:"is-flex is-flex-wrap-nowrap",children:[n,t.jsx(j,{params:s(r),children:t.jsx(O,{sortType:r})})]})},n)),t.jsx("th",{children:"Mother"}),t.jsx("th",{children:"Father"})]})}),t.jsx("tbody",{children:e.map(r=>t.jsx(k,{person:r},r.slug))})]})},C=()=>{const[e,s]=N(),r=e.get("sex")||"",n=e.get("name")||"",a=e.getAll("centuries")||[];return{sex:r,centuries:a,name:n,searchParams:e,toogleCenturies:o=>a.includes(o)?a.filter(d=>d!==o):[...a,o],handleChangeName:o=>{s(o?g(e,{name:o}):g(e,{name:null}))}}},X="https://mate-academy.github.io/react_people-table/api/people.json";function U(e){return new Promise(s=>setTimeout(s,e))}async function V(){return U(500).then(()=>fetch(X)).then(e=>e.json())}const E=e=>s=>e!==null&&s.name===e,L=e=>e||"-",W=e=>e.map(s=>({...s,motherName:L(s.motherName),fatherName:L(s.fatherName),mother:e.find(E(s.motherName)),father:e.find(E(s.fatherName))})),_=e=>(s,r)=>e===u.DESC?r.name.toLowerCase().localeCompare(s.name.toLowerCase()):s.name.toLowerCase().localeCompare(r.name.toLowerCase()),$=e=>(s,r)=>e===u.DESC?r.sex.toLowerCase().localeCompare(s.sex.toLowerCase()):s.sex.toLowerCase().localeCompare(r.sex.toLowerCase()),z=e=>(s,r)=>e===u.DESC?r.born-s.born:s.born-r.born,G=e=>(s,r)=>e===u.DESC?r.died-s.died:s.died-r.died,H=(e,s)=>e===i.NAME?_(s):$(s),J=(e,s)=>e===i.BORN?z(s):G(s),K=(e,s,r)=>{const n=structuredClone(e);return s===i.DIED||s===i.BORN?n.sort(J(s,r)):s===i.NAME||s===i.SEX?n.sort(H(s,r)):n},Q=e=>s=>{const r=Math.ceil(s.died/100);return e.length?e.includes(`${r}`):!0},Y=e=>s=>e?s.sex===e:!0,Z=e=>({name:s,motherName:r,fatherName:n})=>s.includes(e)||(n==null?void 0:n.includes(e))||(r==null?void 0:r.includes(e)),q=(e,s,r)=>n=>[Y(e),Q(s),Z(r)].every(a=>a(n)),ee=(e,s,r,n)=>e.filter(q(s,n,r)),se=()=>{const{sex:e,centuries:s,name:r}=C(),{sort:n,order:a}=y(),[l,c]=h.useState([]),[o,d]=h.useState(!0),[m,S]=h.useState(""),b=h.useMemo(()=>K(l,n,a),[l,n,a]),w=h.useMemo(()=>ee(b,e,r,s),[b,e,r,s]);return h.useLayoutEffect(()=>{V().then(p=>{Array.isArray(p)?c(W(p)):S("Fetch people with an error")}).catch(p=>{S(p.message)}).finally(()=>d(!1))},[]),{people:l,error:m,isLoading:o,filtredPeople:w}},te=()=>{const{filtredPeople:e,isLoading:s,error:r,people:n}=se(),{centuries:a,name:l,sex:c}=C(),o=!n.length&&!s,d=!!(a.length||l||c),m=()=>{switch(!0){case!!r:return t.jsx(D,{dataCy:"peopleLoadingError",errorMessage:r});case o:return t.jsx("p",{"data-cy":"noPeopleMessage",children:"There are no people on the server"});case(!e.length&&d):return t.jsx("p",{children:"There are no people matching the current search criteria"});case!!e.length:return t.jsx(T,{people:e});default:return null}};return t.jsx("div",{className:"column",children:t.jsxs("div",{className:"box table-container",children:[s&&t.jsx(A,{}),m()]})})},re=()=>{const{name:e,centuries:s,sex:r,handleChangeName:n,toogleCenturies:a}=C();return t.jsx("div",{className:"column is-7-tablet is-narrow-desktop",children:t.jsxs("nav",{className:"panel",children:[t.jsx("p",{className:"panel-heading",children:"Filters"}),t.jsx("p",{className:"panel-tabs","data-cy":"SexFilter",children:M.map(({params:l,title:c})=>t.jsx(j,{params:l,className:x({"is-active":r===(l.sex?l.sex:"")}),children:c},c))}),t.jsx("div",{className:"panel-block",children:t.jsxs("p",{className:"control has-icons-left",children:[t.jsx("input",{"data-cy":"NameFilter",type:"search",className:"input",placeholder:"Search",onChange:l=>n(l.target.value),value:e}),t.jsx("span",{className:"icon is-left",children:t.jsx("i",{className:"fas fa-search","aria-hidden":"true"})})]})}),t.jsx("div",{className:"panel-block",children:t.jsxs("div",{className:"level is-flex-grow-1 is-mobile","data-cy":"CenturyFilter",children:[t.jsx("div",{className:"level-left",children:I.map(({century:l,title:c})=>t.jsx(j,{"data-cy":"century",params:{centuries:a(l)},className:x("button mr-1",{"is-info":s.includes(l)}),children:c},c))}),t.jsx("div",{className:"level-right ml-4",children:t.jsx(j,{"data-cy":"centuryALL",className:x("button","is-success",{"is-outlined":s.length}),params:{centuries:null},children:"All"})})]})}),t.jsx("div",{className:"panel-block",children:t.jsx(P,{"data-cy":"centuryALL",className:"button is-link is-outlined is-fullwidth",to:"/people",children:"Reset all filters"})})]})})},le=()=>t.jsxs(t.Fragment,{children:[t.jsx(B,{text:"People Page"}),t.jsx("div",{className:"block",children:t.jsxs("div",{className:"columns is-desktop is-flex-direction-row-reverse",children:[t.jsx(re,{}),t.jsx(te,{})]})})]});export{le as default};
